---
title: Java菜谱（五）——怎么把字符串列表合并为一个字符串？
date: 2021-04-26 18:00:00
permalink: /pages/java-cookbook-five/
description: 详细介绍Java中字符串合并的多种方法，包括String.join()、StringJoiner、Stream收集器等，以及性能优化建议
categories: 
  - Java
  - Java基础
tags: 
  - 字符串操作
  - String.join
  - StringJoiner
  - Stream
  - 性能优化
author: 
  name: 吉森
  link: https://github.com/lhing17
---

今天的菜品是这样的：

怎样把许多小字符串合并成一个大的字符串。

## 快速参考

- 可以用 `String.join()` 方法将字符串的 List 或数组拼接成一个大字符串，并指定分隔符
- 也可以手动创建 `StringJoiner` 对象，指定分隔符、前缀和后缀
- 如果需要先对字符串进行处理，可以将 List 或数组转成 Stream，处理后再利用 `Collectors.joining()` 方法进行合并
- 避免在循环中使用 `+` 操作符进行字符串拼接

<!-- more -->

## String.join() 方法

如果想要合并的字符串在一个列表、数组或其他可迭代对象中，那么合并它们最快的方法就是使用 `String.join()` 静态方法。这一个 API 可以说是千呼万唤才在 JDK 8 中"始出来"，因为其他语言很早就支持这一方便的特性。示例如下：

```java
List<String> list = List.of("Java", "is", "very", "cool"); // 注意这个api是jdk9之后引入的
final String join = String.join(",", list);
System.out.println(join); // Java,is,very,cool
```

`String.join()` 方法的第一个参数是分隔符，即字符串拼接时连接各个小字符串的字符，第二个参数是可迭代对象或者不定长参数。因此该 API 支持数组以及 List、Set 等各种可迭代对象，也可以按不定长的方式使用：

```java
final String join = String.join(",", "Java", "is", "very", "cool");
System.out.println(join); // Java,is,very,cool
```
## StringJoiner

通过 `String.join()` 两个重载方法的源码我们发现，`String.join()` 方法是通过创建 `StringJoiner` 对象实现的，该类同样也是在 JDK 8 版本引入的。

```java
/* String.join()源码 */
public static String join(CharSequence delimiter, CharSequence... elements) {
    Objects.requireNonNull(delimiter);
    Objects.requireNonNull(elements);
    StringJoiner joiner = new StringJoiner(delimiter);
    for (CharSequence cs: elements) {
        joiner.add(cs);
    }
    return joiner.toString();
}

public static String join(CharSequence delimiter,
        Iterable<? extends CharSequence> elements) {
    Objects.requireNonNull(delimiter);
    Objects.requireNonNull(elements);
    StringJoiner joiner = new StringJoiner(delimiter);
    for (CharSequence cs: elements) {
        joiner.add(cs);
    }
    return joiner.toString();
}
```

有时候我们也可以主动创建 `StringJoiner` 类来实现字符串的合并，如在合并结果需要前后缀的情况下：

```java
StringJoiner joiner = new StringJoiner("-", "(", ")");
List<String> list = List.of("Java", "is", "very", "cool");
list.forEach(joiner::add);
System.out.println(joiner.toString());
```
## Stream 收集器的 Collectors.joining()

有时候我们需要对原字符串列表进行一定处理后再进行拼接，这时我们就可以用 Stream 的 `collect` 方法直接对处理后的字符串进行拼接，示例如下：

```java
List<String> list = List.of("Java", "is", "very", "cool");
final String result = list.stream().map(s -> s + "abc").collect(Collectors.joining("-"));
System.out.println(result); // Javaabc-isabc-veryabc-coolabc
```
## + 号与 StringBuilder

如果只是要简单连接一些字符串，一般直接使用 `+` 操作符就足够完成任务了。但是我们需要意识到，在使用 `+` 操作符对大量字符串进行拼接的时候，这种连接的效率是很低的。

因为使用 `+` 操作符拼接字符串是 Java 内置的一种操作符重载的行为，在编译阶段，非字面量字符串进行拼接时，会被编译器改写为通过 `StringBuilder` 的 `append` 方法进行拼接。如果在循环结构中使用 `+` 进行字符串拼接，则会产生大量的 `StringBuilder` 对象，降低整个程序运行效率。因此我们应该避免在循环结构中使用加号进行字符串拼接，改用 `String.join` 方法或者手动在循环外创建 `StringBuilder` 对象。

```java
String str = "";
// 错误！！！不能在循环中使用+或+=进行字符串拼接!!!
//for (s: list) {
//    str += s;
//}

// 方法1，推荐
str = String.join("", str);

// 方法2，相对麻烦
StringBuilder sb = new StringBuilder();
list.forEach(sb::append);
str = sb.toString();

// 方法3，相对麻烦
StringJoiner sj = new StringJoiner("");
list.forEach(sj::add);
str = sj.toString();
```