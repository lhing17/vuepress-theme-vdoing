---
title: Java Stream findFirstæ–¹æ³•çš„ç©ºæŒ‡é’ˆé™·é˜±è¯¦è§£
date: 2025-08-14 08:43:00
permalink: /pages/15ee00/
categories:
  - Java
  - JavaåŸºç¡€
tags:
  - å‡½æ•°å¼ç¼–ç¨‹
  - Stream API
  - Optional
  - ç©ºæŒ‡é’ˆå¼‚å¸¸
author:
  name: å‰æ£®
  link: https://github.com/lhing17
---
## å‰è¨€

åœ¨Java 8å¼•å…¥Stream APIåï¼Œå‡½æ•°å¼ç¼–ç¨‹é£æ ¼åœ¨Javaå¼€å‘ä¸­å˜å¾—è¶Šæ¥è¶Šæµè¡Œã€‚ç„¶è€Œï¼Œåœ¨ä½¿ç”¨Stream APIçš„è¿‡ç¨‹ä¸­ï¼Œå¼€å‘è€…ç»å¸¸ä¼šé‡åˆ°ä¸€äº›æ„æƒ³ä¸åˆ°çš„é™·é˜±ã€‚æœ¬æ–‡å°†æ·±å…¥åˆ†æä¸€ä¸ªåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®é™…é‡åˆ°çš„é—®é¢˜ï¼š**Streamçš„findFirstæ–¹æ³•å¼•å‘çš„ç©ºæŒ‡é’ˆå¼‚å¸¸**ã€‚

è¿™ä¸ªé—®é¢˜çœ‹ä¼¼ç®€å•ï¼Œä½†èƒŒåæ¶‰åŠåˆ°Optionalç±»çš„è®¾è®¡åŸç†ã€Stream APIçš„å†…éƒ¨å®ç°æœºåˆ¶ï¼Œä»¥åŠJavaä¸­nullå€¼å¤„ç†çš„æœ€ä½³å®è·µã€‚é€šè¿‡æœ¬æ–‡çš„å­¦ä¹ ï¼Œä½ å°†èƒ½å¤Ÿï¼š

- ç†è§£Stream findFirstæ–¹æ³•çš„å·¥ä½œåŸç†
- æŒæ¡Optionalç±»çš„æ­£ç¡®ä½¿ç”¨æ–¹å¼
- å­¦ä¼šé¿å…å¸¸è§çš„ç©ºæŒ‡é’ˆå¼‚å¸¸é™·é˜±
- æŒæ¡å¤„ç†å¯èƒ½ä¸ºnullçš„Streamå…ƒç´ çš„æœ€ä½³å®è·µ

<!-- more -->

## é—®é¢˜å‘ç°ä¸åˆ†æ

### ğŸ› é—®é¢˜ç°è±¡

åœ¨ä¸€æ¬¡ç”Ÿäº§ç¯å¢ƒæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªä»¤äººå›°æƒ‘çš„ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚é—®é¢˜ä»£ç å¦‚ä¸‹ï¼š

```java
List<String> idList = Arrays.asList("001", "002", "003");
Map<String, Person> personMap = new HashMap<>();
// æ³¨æ„ï¼špersonMapä¸­åªåŒ…å«éƒ¨åˆ†IDå¯¹åº”çš„Personå¯¹è±¡
personMap.put("001", new Person("å¼ ä¸‰"));
personMap.put("003", new Person("æå››"));
// "002"å¯¹åº”çš„Personä¸å­˜åœ¨

// é—®é¢˜ä»£ç ï¼šè¿™é‡Œä¼šæŠ›å‡ºNullPointerException
Person person = idList.stream()
        .map(id -> personMap.get(id))  // è¿™é‡Œå¯èƒ½è¿”å›null
        .findFirst()                   // è¿™é‡ŒæŠ›å‡ºå¼‚å¸¸ï¼
        .orElse(null);
```

### ğŸ¤” åˆæ­¥åˆ†æçš„å›°æƒ‘

ä¹ä¸€çœ‹ï¼Œè¿™æ®µä»£ç ä¼¼ä¹ä¸åº”è¯¥æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ï¼š

1. `idList.stream()` åˆ›å»ºäº†ä¸€ä¸ªStream
2. `.map(id -> personMap.get(id))` å°†IDæ˜ å°„ä¸ºPersonå¯¹è±¡
3. `.findFirst()` è¿”å›ä¸€ä¸ªOptionalå¯¹è±¡
4. `.orElse(null)` ä»Optionalä¸­è·å–å€¼ï¼Œå¦‚æœä¸ºç©ºåˆ™è¿”å›null

æŒ‰ç…§è¿™ä¸ªé€»è¾‘ï¼Œå³ä½¿æ²¡æœ‰æ‰¾åˆ°ä»»ä½•Personå¯¹è±¡ï¼Œ`findFirst()`ä¹Ÿåº”è¯¥è¿”å›`Optional.empty()`ï¼Œç„¶å`orElse(null)`è¿”å›nullï¼Œä¸åº”è¯¥æœ‰ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚

### ğŸ” é”™è¯¯ä¿¡æ¯åˆ†æ

ä½†æ˜¯ï¼Œå®é™…çš„é”™è¯¯å †æ ˆæ˜ç¡®æŒ‡å‡ºï¼š**ç©ºæŒ‡é’ˆå¼‚å¸¸å‘ç”Ÿåœ¨findFirstæ–¹æ³•çš„è°ƒç”¨ä¸­**ï¼

```
Exception in thread "main" java.lang.NullPointerException
    at java.util.Optional.of(Optional.java:258)
    at java.util.stream.FindOps$FindSink.accept(FindOps.java:146)
    at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)
    ...
```

è¿™ä¸ªé”™è¯¯ä¿¡æ¯ç»™äº†æˆ‘ä»¬é‡è¦çš„çº¿ç´¢ï¼šå¼‚å¸¸å‘ç”Ÿåœ¨`Optional.of()`æ–¹æ³•ä¸­ï¼

## åŸºç¡€çŸ¥è¯†å›é¡¾

åœ¨æ·±å…¥åˆ†æé—®é¢˜ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå›é¡¾ä¸€ä¸‹ç›¸å…³çš„åŸºç¡€çŸ¥è¯†ã€‚

### Stream API åŸºç¡€

**Stream**æ˜¯Java 8å¼•å…¥çš„ä¸€ä¸ªå¼ºå¤§çš„æ•°æ®å¤„ç†APIï¼Œå®ƒå…è®¸æˆ‘ä»¬ä»¥å£°æ˜å¼çš„æ–¹å¼å¤„ç†æ•°æ®é›†åˆã€‚

```java
// Streamçš„åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹
List<String> names = Arrays.asList("Alice", "Bob", "Charlie");
List<String> result = names.stream()
    .filter(name -> name.length() > 3)  // ä¸­é—´æ“ä½œï¼šè¿‡æ»¤
    .map(String::toUpperCase)           // ä¸­é—´æ“ä½œï¼šè½¬æ¢
    .collect(Collectors.toList());      // ç»ˆç«¯æ“ä½œï¼šæ”¶é›†
```

Streamæ“ä½œåˆ†ä¸ºä¸¤ç±»ï¼š
- **ä¸­é—´æ“ä½œ**ï¼ˆIntermediate Operationsï¼‰ï¼šå¦‚`filter`ã€`map`ã€`sorted`ç­‰ï¼Œè¿”å›æ–°çš„Stream
- **ç»ˆç«¯æ“ä½œ**ï¼ˆTerminal Operationsï¼‰ï¼šå¦‚`findFirst`ã€`collect`ã€`forEach`ç­‰ï¼Œè§¦å‘Streamçš„æ‰§è¡Œ

### Optional ç±»è¯¦è§£

**Optional**æ˜¯Java 8å¼•å…¥çš„ä¸€ä¸ªå®¹å™¨ç±»ï¼Œç”¨äºä¼˜é›…åœ°å¤„ç†å¯èƒ½ä¸ºnullçš„å€¼ã€‚

```java
// Optionalçš„åŸºæœ¬ç”¨æ³•
Optional<String> optional1 = Optional.of("Hello");        // åŒ…å«énullå€¼
Optional<String> optional2 = Optional.empty();            // ç©ºOptional
Optional<String> optional3 = Optional.ofNullable(null);   // å¯èƒ½ä¸ºnullçš„å€¼

// è·å–å€¼çš„æ–¹æ³•
String value1 = optional1.orElse("Default");              // å¦‚æœä¸ºç©ºåˆ™è¿”å›é»˜è®¤å€¼
String value2 = optional1.orElseGet(() -> "Computed");     // å¦‚æœä¸ºç©ºåˆ™è®¡ç®—é»˜è®¤å€¼
String value3 = optional1.orElseThrow();                  // å¦‚æœä¸ºç©ºåˆ™æŠ›å‡ºå¼‚å¸¸
```

**é‡è¦åŒºåˆ«**ï¼š
- `Optional.of(value)`ï¼šè¦æ±‚valueä¸èƒ½ä¸ºnullï¼Œå¦åˆ™æŠ›å‡ºNullPointerException
- `Optional.ofNullable(value)`ï¼šå…è®¸valueä¸ºnullï¼Œå¦‚æœä¸ºnullåˆ™è¿”å›Optional.empty()

### findFirst æ–¹æ³•ç®€ä»‹

`findFirst()`æ˜¯Streamçš„ä¸€ä¸ªç»ˆç«¯æ“ä½œï¼Œç”¨äºè¿”å›Streamä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚

```java
// findFirstçš„åŸºæœ¬ç”¨æ³•
Optional<String> first = Stream.of("a", "b", "c")
    .findFirst();  // è¿”å›Optional.of("a")

Optional<String> empty = Stream.<String>empty()
    .findFirst();  // è¿”å›Optional.empty()
```

## æºç æ·±åº¦åˆ†æ

ç°åœ¨è®©æˆ‘ä»¬æ·±å…¥åˆ†æ`findFirst`æ–¹æ³•çš„æºç å®ç°ï¼Œç†è§£é—®é¢˜çš„æ ¹æœ¬åŸå› ã€‚

### findFirst æ–¹æ³•æºç 

```java
// Streamæ¥å£ä¸­çš„findFirstæ–¹æ³•
public interface Stream<T> extends BaseStream<T, Stream<T>> {
    /**
     * Returns an {@code Optional} describing the first element of this stream,
     * or an empty {@code Optional} if the stream is empty.
     */
    Optional<T> findFirst();
}
```

### FindOps å®ç°ç±»åˆ†æ

`findFirst`çš„å…·ä½“å®ç°åœ¨`FindOps`ç±»ä¸­ï¼š

```java
// FindOps.java ä¸­çš„å…³é”®ä»£ç 
static final class FindSink<T, O> implements TerminalSink<T, O> {
    boolean hasValue;
    T value;

    @Override
    public void accept(T value) {
        if (!hasValue) {
            hasValue = true;
            this.value = value;  // æ³¨æ„ï¼šè¿™é‡Œç›´æ¥èµ‹å€¼ï¼Œå¯èƒ½ä¸ºnullï¼
        }
    }

    @Override
    public O get() {
        return hasValue ? Optional.of(value) : Optional.empty();
        //              ^^^^^^^^^^^^^^^^^
        //              é—®é¢˜å°±åœ¨è¿™é‡Œï¼å¦‚æœvalueä¸ºnullï¼ŒOptional.of()ä¼šæŠ›å‡ºå¼‚å¸¸
    }
}
```

### Optional.of æ–¹æ³•æºç 

```java
// Optional.java ä¸­çš„ofæ–¹æ³•
public static <T> Optional<T> of(T value) {
    return new Optional<>(Objects.requireNonNull(value));
    //                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    //                    è¿™é‡Œä¼šæ£€æŸ¥valueæ˜¯å¦ä¸ºnullï¼Œå¦‚æœä¸ºnullåˆ™æŠ›å‡ºNullPointerException
}

// Objects.requireNonNull æ–¹æ³•
public static <T> T requireNonNull(T obj) {
    if (obj == null)
        throw new NullPointerException();
    return obj;
}
```

### é—®é¢˜æ ¹å› åˆ†æ

ç°åœ¨é—®é¢˜çš„æ ¹å› å°±æ¸…æ¥šäº†ï¼š

1. **Streamå¤„ç†è¿‡ç¨‹**ï¼š`idList.stream().map(id -> personMap.get(id))`åˆ›å»ºäº†ä¸€ä¸ªå¯èƒ½åŒ…å«nullå…ƒç´ çš„Stream
2. **findFirstæŸ¥æ‰¾**ï¼š`findFirst()`æ‰¾åˆ°äº†Streamä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä½†è¿™ä¸ªå…ƒç´ æ˜¯null
3. **Optionalå°è£…å¤±è´¥**ï¼š`findFirst()`å†…éƒ¨è°ƒç”¨`Optional.of(null)`å°è¯•å°è£…nullå€¼
4. **å¼‚å¸¸æŠ›å‡º**ï¼š`Optional.of()`æ–¹æ³•ä¸å…è®¸nullå‚æ•°ï¼ŒæŠ›å‡ºNullPointerException

**å…³é”®ç†è§£**ï¼š
- "æ‰¾åˆ°äº†ä¸€ä¸ªnullå€¼" â‰  "æ²¡æœ‰æ‰¾åˆ°å€¼"
- `Optional.of(null)` ä¼šæŠ›å‡ºå¼‚å¸¸
- `Optional.empty()` è¡¨ç¤ºæ²¡æœ‰å€¼

## é—®é¢˜å¤ç°ä¸æ¼”ç¤º

è®©æˆ‘ä»¬é€šè¿‡å®Œæ•´çš„ä»£ç ç¤ºä¾‹æ¥å¤ç°è¿™ä¸ªé—®é¢˜ï¼š

### å®Œæ•´çš„é—®é¢˜å¤ç°ä»£ç 

```java
import java.util.*;
import java.util.stream.*;

public class FindFirstNullPointerDemo {
    
    static class Person {
        private String name;
        
        public Person(String name) {
            this.name = name;
        }
        
        @Override
        public String toString() {
            return "Person{name='" + name + "'}";
        }
    }
    
    public static void main(String[] args) {
        // å‡†å¤‡æµ‹è¯•æ•°æ®
        List<String> idList = Arrays.asList("001", "002", "003");
        Map<String, Person> personMap = new HashMap<>();
        personMap.put("001", new Person("å¼ ä¸‰"));
        personMap.put("003", new Person("æå››"));
        // æ³¨æ„ï¼š"002"å¯¹åº”çš„Personä¸å­˜åœ¨ï¼Œget("002")ä¼šè¿”å›null
        
        System.out.println("=== é—®é¢˜æ¼”ç¤º ===");
        
        // æ¼”ç¤º1ï¼šç›´æ¥ä½¿ç”¨map + findFirstï¼ˆä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰
        try {
            Person person = idList.stream()
                    .map(id -> {
                        Person p = personMap.get(id);
                        System.out.println("æ˜ å°„ " + id + " -> " + p);
                        return p;
                    })
                    .findFirst()
                    .orElse(null);
            System.out.println("ç»“æœ: " + person);
        } catch (NullPointerException e) {
            System.out.println("âŒ æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸: " + e.getMessage());
            e.printStackTrace();
        }
        
        System.out.println("\n=== å¯¹æ¯”ï¼šæ²¡æœ‰nullå…ƒç´ çš„æƒ…å†µ ===");
        
        // æ¼”ç¤º2ï¼šæ‰€æœ‰å…ƒç´ éƒ½å­˜åœ¨çš„æƒ…å†µï¼ˆæ­£å¸¸å·¥ä½œï¼‰
        List<String> validIdList = Arrays.asList("001", "003");
        Person validPerson = validIdList.stream()
                .map(id -> personMap.get(id))
                .findFirst()
                .orElse(null);
        System.out.println("âœ… æ­£å¸¸ç»“æœ: " + validPerson);
        
        System.out.println("\n=== å¯¹æ¯”ï¼šç©ºStreamçš„æƒ…å†µ ===");
        
        // æ¼”ç¤º3ï¼šç©ºStreamçš„æƒ…å†µï¼ˆæ­£å¸¸å·¥ä½œï¼‰
        Person emptyResult = Collections.<String>emptyList().stream()
                .map(id -> personMap.get(id))
                .findFirst()
                .orElse(null);
        System.out.println("âœ… ç©ºStreamç»“æœ: " + emptyResult);
    }
}
```

### è¿è¡Œç»“æœåˆ†æ

```
=== é—®é¢˜æ¼”ç¤º ===
æ˜ å°„ 001 -> Person{name='å¼ ä¸‰'}
âŒ æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸: null
java.lang.NullPointerException
    at java.util.Optional.of(Optional.java:258)
    at java.util.stream.FindOps$FindSink.accept(FindOps.java:146)
    ...

=== å¯¹æ¯”ï¼šæ²¡æœ‰nullå…ƒç´ çš„æƒ…å†µ ===
âœ… æ­£å¸¸ç»“æœ: Person{name='å¼ ä¸‰'}

=== å¯¹æ¯”ï¼šç©ºStreamçš„æƒ…å†µ ===
âœ… ç©ºStreamç»“æœ: null
```

ä»ç»“æœå¯ä»¥çœ‹å‡ºï¼š
- å½“Streamä¸­åŒ…å«nullå…ƒç´ æ—¶ï¼Œ`findFirst()`ä¼šæŠ›å‡ºå¼‚å¸¸
- å½“Streamä¸­æ‰€æœ‰å…ƒç´ éƒ½énullæ—¶ï¼Œ`findFirst()`æ­£å¸¸å·¥ä½œ
- å½“Streamä¸ºç©ºæ—¶ï¼Œ`findFirst()`è¿”å›`Optional.empty()`ï¼Œ`orElse(null)`è¿”å›null

## è§£å†³æ–¹æ¡ˆè¯¦è§£

é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æœ‰å¤šç§è§£å†³æ–¹æ¡ˆï¼Œæ¯ç§æ–¹æ¡ˆéƒ½æœ‰å…¶é€‚ç”¨åœºæ™¯ã€‚

### æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨filterè¿‡æ»¤nullå€¼

**æ€è·¯**ï¼šåœ¨è°ƒç”¨`findFirst()`ä¹‹å‰ï¼Œå…ˆè¿‡æ»¤æ‰nullå€¼ã€‚

```java
// è§£å†³æ–¹æ¡ˆ1ï¼šè¿‡æ»¤nullå€¼
Person person = idList.stream()
        .map(id -> personMap.get(id))
        .filter(Objects::nonNull)           // è¿‡æ»¤æ‰nullå€¼
        .findFirst()
        .orElse(null);

System.out.println("æ–¹æ¡ˆ1ç»“æœ: " + person);
```

**ä¼˜ç‚¹**ï¼š
- ç®€å•ç›´è§‚ï¼Œæ˜“äºç†è§£
- æ€§èƒ½è¾ƒå¥½ï¼Œåªéœ€è¦ä¸€æ¬¡è¿‡æ»¤æ“ä½œ

**ç¼ºç‚¹**ï¼š
- å¦‚æœæ‰€æœ‰æ˜ å°„ç»“æœéƒ½æ˜¯nullï¼Œä¼šè¿”å›nullè€Œä¸æ˜¯ç¬¬ä¸€ä¸ªnull
- æ”¹å˜äº†åŸå§‹çš„ä¸šåŠ¡é€»è¾‘ï¼ˆè·³è¿‡äº†nullå€¼ï¼‰

### æ–¹æ¡ˆäºŒï¼šä½¿ç”¨Optional.ofNullableåŒ…è£…

**æ€è·¯**ï¼šå°†æ˜ å°„ç»“æœåŒ…è£…æˆOptionalï¼Œç„¶åå¤„ç†Optionalæµã€‚

```java
// è§£å†³æ–¹æ¡ˆ2ï¼šä½¿ç”¨Optional.ofNullable
Person person = idList.stream()
        .map(id -> Optional.ofNullable(personMap.get(id)))  // åŒ…è£…æˆOptional
        .filter(Optional::isPresent)                        // è¿‡æ»¤ç©ºOptional
        .map(Optional::get)                                 // æå–å€¼
        .findFirst()
        .orElse(null);

System.out.println("æ–¹æ¡ˆ2ç»“æœ: " + person);
```

**ä¼˜ç‚¹**ï¼š
- æ˜ç¡®è¡¨è¾¾äº†å¯èƒ½ä¸ºnullçš„è¯­ä¹‰
- ç±»å‹å®‰å…¨ï¼Œç¼–è¯‘æ—¶å°±èƒ½å‘ç°é—®é¢˜

**ç¼ºç‚¹**ï¼š
- ä»£ç è¾ƒä¸ºå†—é•¿
- æ€§èƒ½å¼€é”€ç¨å¤§ï¼ˆåˆ›å»ºOptionalå¯¹è±¡ï¼‰

### æ–¹æ¡ˆä¸‰ï¼šä½¿ç”¨flatMap + Optional.ofNullable

**æ€è·¯**ï¼šä½¿ç”¨`flatMap`ç»“åˆ`Optional.ofNullable`ï¼Œæ›´åŠ å‡½æ•°å¼çš„å†™æ³•ã€‚

```java
// è§£å†³æ–¹æ¡ˆ3ï¼šä½¿ç”¨flatMap
Person person = idList.stream()
        .map(id -> Optional.ofNullable(personMap.get(id)))  // æ˜ å°„ä¸ºOptional
        .flatMap(Optional::stream)                          // å±•å¹³Optional
        .findFirst()
        .orElse(null);

System.out.println("æ–¹æ¡ˆ3ç»“æœ: " + person);
```

**æ³¨æ„**ï¼š`Optional::stream`æ˜¯Java 9å¼•å…¥çš„æ–¹æ³•ï¼Œå¦‚æœä½¿ç”¨Java 8ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š

```java
// Java 8å…¼å®¹ç‰ˆæœ¬
Person person = idList.stream()
        .map(id -> Optional.ofNullable(personMap.get(id)))
        .filter(Optional::isPresent)
        .map(Optional::get)
        .findFirst()
        .orElse(null);
```

**ä¼˜ç‚¹**ï¼š
- å‡½æ•°å¼ç¼–ç¨‹é£æ ¼
- è¯­ä¹‰æ¸…æ™°

**ç¼ºç‚¹**ï¼š
- éœ€è¦Java 9+ï¼ˆä½¿ç”¨Optional::streamï¼‰
- å¯¹åˆå­¦è€…æ¥è¯´å¯èƒ½è¾ƒéš¾ç†è§£

### æ–¹æ¡ˆå››ï¼šæå‰æ£€æŸ¥å’Œå¤„ç†

**æ€è·¯**ï¼šåœ¨Streamæ“ä½œä¹‹å‰å°±å¤„ç†å¯èƒ½çš„nullæƒ…å†µã€‚

```java
// è§£å†³æ–¹æ¡ˆ4ï¼šæå‰æ£€æŸ¥
Person person = null;
for (String id : idList) {
    Person p = personMap.get(id);
    if (p != null) {
        person = p;
        break;
    }
}

System.out.println("æ–¹æ¡ˆ4ç»“æœ: " + person);
```

æˆ–è€…ä½¿ç”¨Streamä½†æå‰å¤„ç†ï¼š

```java
// è§£å†³æ–¹æ¡ˆ4å˜ä½“ï¼šStream + æå‰æ£€æŸ¥
Person person = idList.stream()
        .filter(id -> personMap.containsKey(id))  // æå‰æ£€æŸ¥keyæ˜¯å¦å­˜åœ¨
        .map(id -> personMap.get(id))
        .findFirst()
        .orElse(null);

System.out.println("æ–¹æ¡ˆ4å˜ä½“ç»“æœ: " + person);
```

**ä¼˜ç‚¹**ï¼š
- æ€§èƒ½æœ€å¥½ï¼ˆé¿å…äº†ä¸å¿…è¦çš„æ˜ å°„æ“ä½œï¼‰
- é€»è¾‘æ¸…æ™°

**ç¼ºç‚¹**ï¼š
- ä¸å¤Ÿå‡½æ•°å¼
- éœ€è¦äº†è§£æ•°æ®ç»“æ„çš„ç‰¹æ€§ï¼ˆå¦‚Mapçš„containsKeyæ–¹æ³•ï¼‰

### æ–¹æ¡ˆäº”ï¼šè‡ªå®šä¹‰å®‰å…¨çš„findFirstæ–¹æ³•

**æ€è·¯**ï¼šåˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿå®‰å…¨å¤„ç†nullå€¼çš„findFirstæ–¹æ³•ã€‚

```java
public class SafeStreamUtils {
    
    /**
     * å®‰å…¨çš„findFirstæ–¹æ³•ï¼Œèƒ½å¤Ÿå¤„ç†Streamä¸­çš„nullå€¼
     */
    public static <T> Optional<T> findFirstSafe(Stream<T> stream) {
        return stream
                .map(Optional::ofNullable)  // å°†æ¯ä¸ªå…ƒç´ åŒ…è£…æˆOptional
                .findFirst()                // æ‰¾åˆ°ç¬¬ä¸€ä¸ªOptional
                .orElse(Optional.empty());  // å¦‚æœæ²¡æ‰¾åˆ°åˆ™è¿”å›ç©ºOptional
    }
    
    /**
     * æŸ¥æ‰¾ç¬¬ä¸€ä¸ªénullå€¼
     */
    public static <T> Optional<T> findFirstNonNull(Stream<T> stream) {
        return stream
                .filter(Objects::nonNull)
                .findFirst();
    }
}

// ä½¿ç”¨ç¤ºä¾‹
Optional<Person> result = SafeStreamUtils.findFirstSafe(
    idList.stream().map(id -> personMap.get(id))
);
Person person = result.orElse(null);
System.out.println("æ–¹æ¡ˆ5ç»“æœ: " + person);
```

**ä¼˜ç‚¹**ï¼š
- å¯é‡ç”¨ï¼Œæé«˜ä»£ç è´¨é‡
- è¯­ä¹‰æ˜ç¡®
- ç±»å‹å®‰å…¨

**ç¼ºç‚¹**ï¼š
- éœ€è¦é¢å¤–çš„å·¥å…·ç±»
- å›¢é˜Ÿéœ€è¦äº†è§£è¿™äº›è‡ªå®šä¹‰æ–¹æ³•

### æ–¹æ¡ˆå¯¹æ¯”æ€»ç»“

| æ–¹æ¡ˆ | é€‚ç”¨åœºæ™¯ | æ€§èƒ½ | å¯è¯»æ€§ | ç±»å‹å®‰å…¨ |
|------|----------|------|--------|----------|
| filterè¿‡æ»¤null | åªéœ€è¦énullå€¼ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ |
| OptionalåŒ…è£… | éœ€è¦æ˜ç¡®nullè¯­ä¹‰ | â­â­â­ | â­â­â­ | â­â­â­â­â­ |
| flatMapæ–¹å¼ | å‡½æ•°å¼ç¼–ç¨‹é£æ ¼ | â­â­â­ | â­â­ | â­â­â­â­â­ |
| æå‰æ£€æŸ¥ | æ€§èƒ½æ•æ„Ÿåœºæ™¯ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ |
| è‡ªå®šä¹‰å·¥å…· | å›¢é˜Ÿæ ‡å‡†åŒ– | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |

## æœ€ä½³å®è·µå»ºè®®

åŸºäºä»¥ä¸Šåˆ†æï¼Œè¿™é‡Œæä¾›ä¸€äº›ä½¿ç”¨Stream APIçš„æœ€ä½³å®è·µå»ºè®®ï¼š

### 1. ğŸ›¡ï¸ é˜²å¾¡æ€§ç¼–ç¨‹

**æ€»æ˜¯å‡è®¾å¤–éƒ¨æ•°æ®å¯èƒ½ä¸ºnull**ï¼Œåœ¨Streamæ“ä½œä¸­ä¸»åŠ¨å¤„ç†nullå€¼ï¼š

```java
// âŒ å±é™©çš„å†™æ³•
Person person = idList.stream()
        .map(personMap::get)  // å¯èƒ½è¿”å›null
        .findFirst()          // å¯èƒ½æŠ›å‡ºå¼‚å¸¸
        .orElse(null);

// âœ… å®‰å…¨çš„å†™æ³•
Person person = idList.stream()
        .map(personMap::get)
        .filter(Objects::nonNull)  // ä¸»åŠ¨è¿‡æ»¤null
        .findFirst()
        .orElse(null);
```

### 2. ğŸ¯ æ˜ç¡®ä¸šåŠ¡è¯­ä¹‰

**åŒºåˆ†"æ²¡æœ‰æ‰¾åˆ°"å’Œ"æ‰¾åˆ°äº†null"**ï¼š

```java
// å¦‚æœä¸šåŠ¡ä¸Šéœ€è¦åŒºåˆ†è¿™ä¸¤ç§æƒ…å†µ
Optional<Person> result = idList.stream()
        .map(id -> Optional.ofNullable(personMap.get(id)))
        .findFirst()
        .orElse(Optional.empty());

if (result.isPresent()) {
    System.out.println("æ‰¾åˆ°äº†Person: " + result.get());
} else {
    System.out.println("æ²¡æœ‰æ‰¾åˆ°ä»»ä½•Person");
}
```

### 3. ğŸ“ ä½¿ç”¨æœ‰æ„ä¹‰çš„æ–¹æ³•å

**åˆ›å»ºè¯­ä¹‰æ˜ç¡®çš„å·¥å…·æ–¹æ³•**ï¼š

```java
public class PersonService {
    
    /**
     * æ ¹æ®IDåˆ—è¡¨æŸ¥æ‰¾ç¬¬ä¸€ä¸ªå­˜åœ¨çš„Person
     */
    public Optional<Person> findFirstExistingPerson(List<String> idList) {
        return idList.stream()
                .map(personMap::get)
                .filter(Objects::nonNull)
                .findFirst();
    }
    
    /**
     * æ ¹æ®IDåˆ—è¡¨æŸ¥æ‰¾ç¬¬ä¸€ä¸ªPersonï¼ˆå¯èƒ½ä¸ºnullï¼‰
     */
    public Optional<Person> findFirstPersonOrNull(List<String> idList) {
        return idList.stream()
                .map(id -> Optional.ofNullable(personMap.get(id)))
                .findFirst()
                .orElse(Optional.empty());
    }
}
```

### 4. ğŸ” ä½¿ç”¨é™æ€åˆ†æå·¥å…·

**é…ç½®IDEå’Œé™æ€åˆ†æå·¥å…·**æ¥æ£€æµ‹æ½œåœ¨çš„nullé—®é¢˜ï¼š

```java
// ä½¿ç”¨æ³¨è§£æ ‡è®°å¯èƒ½ä¸ºnullçš„è¿”å›å€¼
@Nullable
public Person getPersonById(String id) {
    return personMap.get(id);
}

// ä½¿ç”¨æ³¨è§£æ ‡è®°ä¸èƒ½ä¸ºnullçš„å‚æ•°
public void processPerson(@NonNull Person person) {
    // å¤„ç†é€»è¾‘
}
```

### 5. ğŸ§ª ç¼–å†™å•å…ƒæµ‹è¯•

**é’ˆå¯¹è¾¹ç•Œæƒ…å†µç¼–å†™æµ‹è¯•**ï¼š

```java
@Test
public void testFindFirstWithNullValues() {
    List<String> idList = Arrays.asList("missing1", "existing", "missing2");
    Map<String, Person> personMap = Map.of("existing", new Person("Test"));
    
    // æµ‹è¯•è¿‡æ»¤nullå€¼çš„æƒ…å†µ
    Optional<Person> result = idList.stream()
            .map(personMap::get)
            .filter(Objects::nonNull)
            .findFirst();
    
    assertTrue(result.isPresent());
    assertEquals("Test", result.get().getName());
}

@Test
public void testFindFirstWithAllNullValues() {
    List<String> idList = Arrays.asList("missing1", "missing2");
    Map<String, Person> personMap = Collections.emptyMap();
    
    Optional<Person> result = idList.stream()
            .map(personMap::get)
            .filter(Objects::nonNull)
            .findFirst();
    
    assertFalse(result.isPresent());
}
```

## å¸¸è§é™·é˜±ä¸æ³¨æ„äº‹é¡¹

### âš ï¸ é™·é˜±1ï¼šæ··æ·†Optional.ofå’ŒOptional.ofNullable

```java
// âŒ é”™è¯¯ï¼šOptional.ofä¸èƒ½æ¥å—null
Optional<String> opt1 = Optional.of(null);  // æŠ›å‡ºNullPointerException

// âœ… æ­£ç¡®ï¼šä½¿ç”¨Optional.ofNullable
Optional<String> opt2 = Optional.ofNullable(null);  // è¿”å›Optional.empty()
```

### âš ï¸ é™·é˜±2ï¼šåœ¨Streamä¸­ç›´æ¥ä½¿ç”¨å¯èƒ½è¿”å›nullçš„æ–¹æ³•

```java
// âŒ å±é™©ï¼šMap.get()å¯èƒ½è¿”å›null
list.stream()
    .map(map::get)      // å¯èƒ½äº§ç”Ÿnullå…ƒç´ 
    .findFirst();       // å¯èƒ½æŠ›å‡ºå¼‚å¸¸

// âœ… å®‰å…¨ï¼šå…ˆæ£€æŸ¥æˆ–è¿‡æ»¤
list.stream()
    .filter(map::containsKey)  // å…ˆæ£€æŸ¥keyæ˜¯å¦å­˜åœ¨
    .map(map::get)
    .findFirst();
```

### âš ï¸ é™·é˜±3ï¼šå¿½ç•¥Optionalçš„æ­£ç¡®ç”¨æ³•

```java
// âŒ é”™è¯¯ï¼šç›´æ¥è°ƒç”¨get()å¯èƒ½æŠ›å‡ºå¼‚å¸¸
Optional<String> opt = getOptionalValue();
String value = opt.get();  // å¦‚æœoptä¸ºemptyä¼šæŠ›å‡ºNoSuchElementException

// âœ… æ­£ç¡®ï¼šä½¿ç”¨å®‰å…¨çš„æ–¹æ³•
String value = opt.orElse("default");
// æˆ–è€…
if (opt.isPresent()) {
    String value = opt.get();
    // å¤„ç†value
}
```

### âš ï¸ é™·é˜±4ï¼šè¿‡åº¦ä½¿ç”¨Optional

```java
// âŒ ä¸å¿…è¦ï¼šåœ¨ç§æœ‰æ–¹æ³•ä¸­ä½¿ç”¨Optional
private Optional<String> processInternal(String input) {
    // ç§æœ‰æ–¹æ³•é€šå¸¸ä¸éœ€è¦Optional
    return Optional.ofNullable(input);
}

// âœ… æ›´å¥½ï¼šç›´æ¥è¿”å›å¯èƒ½ä¸ºnullçš„å€¼
private String processInternal(String input) {
    return input;  // è°ƒç”¨è€…çŸ¥é“å¯èƒ½ä¸ºnull
}
```

### âš ï¸ é™·é˜±5ï¼šåœ¨é›†åˆä¸­å­˜å‚¨Optional

```java
// âŒ ä¸æ¨èï¼šåœ¨é›†åˆä¸­å­˜å‚¨Optional
List<Optional<String>> list = new ArrayList<>();
list.add(Optional.of("value"));
list.add(Optional.empty());

// âœ… æ›´å¥½ï¼šç›´æ¥å­˜å‚¨å€¼ï¼Œç”¨nullè¡¨ç¤ºç¼ºå¤±
List<String> list = new ArrayList<>();
list.add("value");
list.add(null);
// ç„¶ååœ¨ä½¿ç”¨æ—¶å¤„ç†null
```

## æ€»ç»“

### ğŸ¯ æ ¸å¿ƒè¦ç‚¹å›é¡¾

1. **é—®é¢˜æ ¹å› **ï¼š`findFirst()`å†…éƒ¨ä½¿ç”¨`Optional.of()`å°è£…æ‰¾åˆ°çš„å…ƒç´ ï¼Œè€Œ`Optional.of()`ä¸å…è®¸nullå‚æ•°

2. **å…³é”®åŒºåˆ«**ï¼š
   - "æ‰¾åˆ°äº†nullå€¼" â‰  "æ²¡æœ‰æ‰¾åˆ°å€¼"
   - `Optional.of(null)` ä¼šæŠ›å‡ºå¼‚å¸¸
   - `Optional.empty()` è¡¨ç¤ºæ²¡æœ‰å€¼

3. **è§£å†³ç­–ç•¥**ï¼š
   - ä½¿ç”¨`filter(Objects::nonNull)`è¿‡æ»¤nullå€¼
   - ä½¿ç”¨`Optional.ofNullable()`å®‰å…¨åŒ…è£…
   - æå‰æ£€æŸ¥æ•°æ®æœ‰æ•ˆæ€§
   - åˆ›å»ºå®‰å…¨çš„å·¥å…·æ–¹æ³•

### ğŸ“š å­¦ä¹ æ”¶è·

é€šè¿‡è¿™ä¸ªæ¡ˆä¾‹ï¼Œæˆ‘ä»¬å­¦åˆ°äº†ï¼š

- **Stream APIçš„å†…éƒ¨æœºåˆ¶**ï¼šç†è§£äº†`findFirst()`çš„å®ç°åŸç†
- **Optionalçš„æ­£ç¡®ä½¿ç”¨**ï¼šæŒæ¡äº†`Optional.of()`å’Œ`Optional.ofNullable()`çš„åŒºåˆ«
- **é˜²å¾¡æ€§ç¼–ç¨‹æ€ç»´**ï¼šå­¦ä¼šäº†åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­å¤„ç†nullå€¼çš„æœ€ä½³å®è·µ
- **é—®é¢˜åˆ†ææ–¹æ³•**ï¼šé€šè¿‡æºç åˆ†æå®šä½é—®é¢˜æ ¹å› çš„æŠ€å·§

### ğŸš€ è¿›é˜¶å»ºè®®

1. **æ·±å…¥å­¦ä¹ Stream API**ï¼šäº†è§£æ›´å¤šStreamæ“ä½œçš„å†…éƒ¨å®ç°
2. **æŒæ¡å‡½æ•°å¼ç¼–ç¨‹**ï¼šå­¦ä¹ æ›´å¤šå‡½æ•°å¼ç¼–ç¨‹çš„è®¾è®¡æ¨¡å¼
3. **å…³æ³¨ä»£ç è´¨é‡**ï¼šä½¿ç”¨é™æ€åˆ†æå·¥å…·å’Œå•å…ƒæµ‹è¯•ä¿è¯ä»£ç è´¨é‡
4. **å›¢é˜Ÿè§„èŒƒ**ï¼šå»ºç«‹å›¢é˜Ÿçš„ç¼–ç è§„èŒƒå’Œæœ€ä½³å®è·µ

### ğŸ’¡ æœ€åçš„æ€è€ƒ

è¿™ä¸ªçœ‹ä¼¼ç®€å•çš„é—®é¢˜èƒŒåï¼Œä½“ç°äº†è½¯ä»¶å¼€å‘ä¸­çš„ä¸€ä¸ªé‡è¦åŸåˆ™ï¼š**ç»†èŠ‚å†³å®šæˆè´¥**ã€‚åœ¨ä½¿ç”¨ä»»ä½•APIæ—¶ï¼Œæˆ‘ä»¬éƒ½åº”è¯¥ï¼š

- ä»”ç»†é˜…è¯»æ–‡æ¡£å’Œæºç 
- ç†è§£APIçš„è®¾è®¡æ„å›¾å’Œé™åˆ¶
- è€ƒè™‘è¾¹ç•Œæƒ…å†µå’Œå¼‚å¸¸åœºæ™¯
- ç¼–å†™å……åˆ†çš„æµ‹è¯•ç”¨ä¾‹

åªæœ‰è¿™æ ·ï¼Œæˆ‘ä»¬æ‰èƒ½å†™å‡ºå¥å£®ã€å¯é çš„ä»£ç ï¼Œé¿å…åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é‡åˆ°æ„å¤–çš„é—®é¢˜ã€‚

---

**å‚è€ƒèµ„æ–™**ï¼š
- [Java 8 Stream APIå®˜æ–¹æ–‡æ¡£](https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html)
- [Optionalç±»å®˜æ–¹æ–‡æ¡£](https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html)
- [Javaå‡½æ•°å¼ç¼–ç¨‹æœ€ä½³å®è·µ](https://www.oracle.com/technical-resources/articles/java/architect-lambdas-part1.html)

å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å’Œä½¿ç”¨Java Stream APIï¼å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºè®¨è®ºã€‚